#variables to send emails
$emailSmtpServer = "smtp.live.com"
$emailSmtpServerPort = "587"
$emailSmtpUser = ""
$emailSmtpPass = ""
 
$emailFrom = ""
$emailTo = ""
 
$emailMessage = New-Object System.Net.Mail.MailMessage( $emailFrom , $emailTo )

 
$SMTPClient = New-Object System.Net.Mail.SmtpClient( $emailSmtpServer , $emailSmtpServerPort )
$SMTPClient.EnableSsl = $True
$SMTPClient.Credentials = New-Object System.Net.NetworkCredential( $emailSmtpUser , $emailSmtpPass );

$Cpath = "C:\"
New-Item -Path "c:\" -Name "checkmal" -ItemType "directory"
$counter = 0
while($counter -lt 10) 
{
    $FileName = (Get-Date).tostring("dd-MM-yyyy-hh-mm-ss")
    New-Item -itemType File -Path C:\checkmal -Name ($FileName + ".txt")
    $counter++
    $emailMessage.Subject = "DAY Mail " 
    $emailMessage.Body = (Get-Date).tostring("dd-MM-yyyy-hh-mm-ss")
    try
    {
        $SMTPClient.Send( $emailMessage )
        Write-Output "Message sent."
    }
    catch
    {
        $_.Exception.Message
        Write-Output "Message send failed."
    }
    sleep -s 10
}
